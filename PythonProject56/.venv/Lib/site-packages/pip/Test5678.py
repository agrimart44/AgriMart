import requests
from bs4 import BeautifulSoup
import os
import datetime

# URL of the webpage
url = "https://www.cbsl.gov.lk/en/statistics/economic-indicators/price-report"

# Headers to mimic a real browser request
headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36"
}

# Define the folder path where PDFs will be saved
folder_path = r"C:\Users\rukshan\Documents\GitHub\AgriMart\PythonProject56\.venv\Lib\site-packages\pip\CBSL"

# Create the folder if it doesn't exist
os.makedirs(folder_path, exist_ok=True)

# Get current date in YYYYMMDD format
current_date = '20250307'

# Get webpage content
response = requests.get(url, headers=headers)
soup = BeautifulSoup(response.text, "html.parser")

# Find and download all PDF links that start with "price_report" and contain today's date
for link in soup.find_all("a", href=True):
    if link["href"].endswith(".pdf"):  # Check if it's a PDF file
        pdf_url = link["href"]

        # Ensure the link is absolute
        if not pdf_url.startswith("http"):
            pdf_url = "https://www.cbsl.gov.lk" + pdf_url

        # Get the file name from the URL
        file_name = pdf_url.split("/")[-1]

        # Check if the file starts with "price_report" and contains today's date
        if file_name.lower().startswith("price_report") and current_date in file_name:
            file_path = os.path.join(folder_path, file_name)

            # Download the PDF
            pdf_response = requests.get(pdf_url, headers=headers)
            with open(file_path, "wb") as f:
                f.write(pdf_response.content)
            print(f"Downloaded: {file_name} -> {folder_path}/")

print("Download process completed.")
